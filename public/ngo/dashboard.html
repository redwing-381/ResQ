<!DOCTYPE html>
<html>
<head>
    <title>NGO Dashboard</title>
    <style>
        .alert { padding: 10px; margin: 5px; background: #ffcccc; }
        .sos-request { border: 2px solid red; padding: 15px; margin: 10px; background: #ffe6e6; }
        .accept-button { background-color: #4CAF50; color: white; padding: 8px 16px; border: none; cursor: pointer; }
        .rescued-button { background-color: #2196F3; color: white; padding: 8px 16px; border: none; cursor: pointer; }
        .tab-buttons { margin: 20px 0; }
        .tab-button { padding: 10px 20px; margin-right: 10px; cursor: pointer; }
        .active-tab { background-color: #4CAF50; color: white; }
        .resource-form { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .resource-input { margin: 5px; padding: 8px; width: 200px; }
        .accepted-request { border-color: orange; }
        .rescued-request { border-color: green; }
    </style>
</head>
<body>
    <h1>NGO Dashboard</h1>
    
    <div class="tab-buttons">
        <button class="tab-button active-tab" onclick="showTab('rescue')">Rescue</button>
        <button class="tab-button" onclick="showTab('resource')">Resource</button>
    </div>

    <div id="rescueTab" class="tab-content">
        <h2>Rescue Operations</h2>
        <div id="sosRequests"></div>
        <h3>Completed Rescues</h3>
        <div id="completedRescues"></div>
    </div>

    <div id="resourceTab" class="tab-content" style="display:none;">
        <h2>Resource Management</h2>
        <div class="resource-form">
            <input type="text" id="resourceName" class="resource-input" placeholder="Name">
            <select id="resourceType" class="resource-input">
                <option value="shelter">Shelter</option>
                <option value="medical">Medical Facility</option>
                <option value="food">Food Center</option>
            </select>
            <input type="text" id="resourceLocation" class="resource-input" placeholder="Location">
            <button onclick="addResource()">Add Resource</button>
        </div>
        <div id="resourcesList"></div>
    </div>

    <div id="alerts"></div>

    <script>
        const ws = new WebSocket('ws://localhost:3000/ws/ngo');
        
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active-tab');
            });
            document.getElementById(`${tabName}Tab`).style.display = 'block';
            event.target.classList.add('active-tab');
        }
    
        function acceptRequest(requestId) {
            ws.send(JSON.stringify({
                type: 'accept_sos',
                requestId: requestId,
                responder: "NGO Team #" + Math.floor(Math.random() * 1000).toString().padStart(4, '0')
            }));
        }
    
        function markRescued(requestId) {
            ws.send(JSON.stringify({
                type: 'mark_rescued',
                requestId: requestId
            }));
        }
    
        function addResource() {
            const resource = {
                name: document.getElementById('resourceName').value,
                type: document.getElementById('resourceType').value,
                location: document.getElementById('resourceLocation').value,
                timestamp: new Date().toISOString()
            };
            
            if(resource.name && resource.location) {
                ws.send(JSON.stringify({
                    type: 'add_resource',
                    resource: resource
                }));
                // Clear form fields
                document.getElementById('resourceName').value = '';
                document.getElementById('resourceLocation').value = '';
            }
        }
    
        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            
            if (data.type === 'sos_request') {
                const requestDiv = document.createElement('div');
                requestDiv.className = 'sos-request pending';
                requestDiv.id = `request-${data.requestId}`;
                requestDiv.innerHTML = `
                    <div class="request-header">
                        <span class="emergency-icon">üö®</span>
                        <h3>EMERGENCY REQUEST</h3>
                        <span class="request-time">${new Date(data.timestamp).toLocaleTimeString()}</span>
                    </div>
                    <div class="request-details">
                        <p><strong>Location:</strong> ${data.location}</p>
                        <div class="request-actions">
                            <button class="accept-button" onclick="acceptRequest('${data.requestId}')">
                                Accept Request
                            </button>
                        </div>
                    </div>
                `;
                document.getElementById('sosRequests').prepend(requestDiv);
            }
            else if (data.type === 'request_updated') {
                const requestDiv = document.getElementById(`request-${data.requestId}`);
                if (requestDiv) {
                    if (data.status === 'accepted') {
                        requestDiv.innerHTML = `
                            <div class="request-header">
                                <span class="status-icon">‚úÖ</span>
                                <h3>ACCEPTED REQUEST</h3>
                                <span class="request-time">${new Date(data.timestamp).toLocaleTimeString()}</span>
                            </div>
                            <div class="request-details">
                                <p><strong>Location:</strong> ${data.location}</p>
                                <p><strong>Responder:</strong> ${data.responder}</p>
                                <div class="request-actions">
                                    <button class="rescued-button" onclick="markRescued('${data.requestId}')">
                                        Mark as Rescued
                                    </button>
                                </div>
                            </div>
                        `;
                        requestDiv.className = 'sos-request accepted';
                    }
                    else if (data.status === 'rescued') {
                        const completedDiv = document.createElement('div');
                        completedDiv.className = 'sos-request rescued';
                        completedDiv.innerHTML = `
                            <div class="request-header">
                                <span class="status-icon">‚úÖ</span>
                                <h3>RESCUED</h3>
                                <span class="request-time">${new Date().toLocaleTimeString()}</span>
                            </div>
                            <div class="request-details">
                                <p><strong>Location:</strong> ${data.location}</p>
                                <p><strong>Rescue Time:</strong> ${new Date().toLocaleTimeString()}</p>
                            </div>
                        `;
                        document.getElementById('completedRescues').prepend(completedDiv);
                        requestDiv.remove();
                    }
                }
            }
            else if (data.type === 'resource_added') {
                const resourceDiv = document.createElement('div');
                resourceDiv.className = 'resource-card';
                resourceDiv.innerHTML = `
                    <div class="resource-header">
                        <h4>${data.resource.name}</h4>
                        <span class="resource-type">${data.resource.type.toUpperCase()}</span>
                    </div>
                    <div class="resource-details">
                        <p class="location">üìç ${data.resource.location}</p>
                        <p class="timestamp">Added: ${new Date(data.resource.timestamp).toLocaleString()}</p>
                    </div>
                `;
                document.getElementById('resourcesList').prepend(resourceDiv);
            }
            else if (data.type === 'disaster_alert') {
                const alertDiv = document.createElement('div');
                alertDiv.className = 'disaster-alert';
                alertDiv.innerHTML = `
                    <div class="alert-header">
                        <span>‚ö†Ô∏è</span>
                        <h4>${data.content}</h4>
                    </div>
                    <div class="alert-guidelines">
                        <p>Required Actions:</p>
                        <ul>
                            ${data.guidelines.map(g => `<li>${g}</li>`).join('')}
                        </ul>
                    </div>
                `;
                document.getElementById('alerts').prepend(alertDiv);
            }
        };
    </script>
</body>
</html>